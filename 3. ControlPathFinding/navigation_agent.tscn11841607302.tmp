[gd_scene load_steps=3 format=3 uid="uid://bkc6vtckomm42"]

[ext_resource type="Texture2D" uid="uid://djf1nsphdxmvv" path="res://Global/Asset/flag.png" id="2_ol0mj"]

[sub_resource type="GDScript" id="GDScript_q5uvt"]
script/source = "extends NavigationAgent2D

@onready var flag: Sprite2D = $Flag

var parent: CollisionObject2D
var nav_active  :bool = false
var is_navigating :bool= true

func _ready() -> void:
	var parent_temp = get_parent()
	if parent_temp is CharacterBody2D:
		print(\"âœ… Parent is CharacterBody2D:\", parent_temp.name)
		parent = parent_temp
		nav_active = true
		
		# Connect navigation signals
		navigation_finished.connect(_on_navigation_finished)
		target_reached.connect(_on_target_reached)
		
		# Hide flag initially
		flag.visible = false
		
		# Enable input processing
		set_process_input(true)
	else:
		print(\"âŒ Parent is not CharacterBody2D, it's:\", parent)
		
func _input(event: InputEvent) -> void:
	if not nav_active:
		return
		
	# Handle right mouse button click
	if event is InputEventMouseButton:
		if event.button_index == MOUSE_BUTTON_RIGHT and event.pressed:
			set_navigation_target(event.position)
		

func set_navigation_target(screen_position: Vector2) -> void:
	# Convert screen position to world position considering camera
	var world_position = Utils.screen_to_world_position(screen_position)
	
	# Set the target position
	target_position = world_position
	set_target_position(target_position)
	
	# Show and position the flag
	flag.global_position = target_position
	flag.visible = true
	
	# Start navigation
	is_navigating = true
	
	print(\"ðŸŽ¯ Navigation target set to:\", target_position)
	
	
func _on_navigation_finished() -> void:
	print(\"ðŸ Navigation finished!\")
	is_navigating = false
	
	# Hide the flag after a delay (optional)
	await get_tree().create_timer(1.0).timeout
	flag.visible = false

func _on_target_reached() -> void:
	print(\"ðŸŽ¯ Target reached!\")
	is_navigating = false
	
	# Hide the flag
	flag.visible = false

"

[node name="NavigationAgent" type="NavigationAgent2D"]
script = SubResource("GDScript_q5uvt")

[node name="Flag" type="Sprite2D" parent="."]
texture = ExtResource("2_ol0mj")
